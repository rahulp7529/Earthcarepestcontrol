(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4623],{94623:function(e,t,l){"use strict";l.d(t,{Z:function(){return V},F:function(){return U}});var a=l(85893),i=l(2337),s=l(67294),r=l(58533),d=l(39854),n=l(5266),o=l(11163),c=l(598),u=l(54167),m=l(51879),h=l(9669),g=l.n(h),p=l(33299),f=l(47922),x=e=>{let{initialImages:t,initialCursor:l,options:a,sortBy:i,filter:r,dateFilter:d}=e,[n,o]=(0,s.useState)(t),[c,u]=(0,s.useState)(l),h=(0,p.useSession)(),[x,v]=(0,s.useState)(!1),[j,y]=(0,s.useState)(!1),b=(0,s.useRef)({sortBy:i,filter:r,dateFilter:d}),w=(0,f.y)("dedupe-grid-images"),k=void 0!==c,C=(0,s.useCallback)(async e=>{y(!0);let{data:t}=await g().get(a.url,{params:{limit:m.NM,cursor:e,userId:h?.data?.user?.id,...a.params}}),l=t.images,i=t.cursor,s=l.map(e=>e.id);return w&&(l=n.filter(e=>!s.includes(e.id))),y(!1),{newImages:l,newCursor:i,nasMoreImages:void 0!==e}},[n,a.params,a.url,h?.data?.user?.id,w]);return(0,s.useEffect)(()=>{let e=!1,t=async()=>{v(!0);let{newImages:t,newCursor:l}=await C(0);e||(l&&u(l),o(t),v(!1))};return b.current.sortBy!==i&&(b.current.sortBy=null,t()),b.current.filter!==r&&(b.current.filter=null,t()),(b.current.dateFilter?.start!==d?.start||b.current.dateFilter?.end!==d?.end)&&(b.current.dateFilter=null,t()),()=>{e=!0}},[i,r,d?.start,d?.end]),{images:n,getMoreImages:(0,s.useCallback)(async()=>{let{newImages:e,newCursor:t}=await C(c);return t&&u(t),setTimeout(()=>o(t=>[...t,...e]),0),e},[c,C]),haveMoreImages:k,setImages:o,showEmptyImages:x,isLoading:j,isLoadingMore:j&&k}},v=l(41752),j=l(93123),y=l(627),b=l(28456),w=l(92323),k=l(41301),C=l.n(k);function N(e){let{deleteImages:t,numSelected:l}=e,{closeModal:i}=(0,w.d)(),s=(0,v.bJ)();return(0,a.jsxs)(b.Z,{onSubmit:e=>{e.preventDefault(),t()},children:[(0,a.jsx)(b.Z.Header,{children:(0,a.jsx)(b.Z.HeaderTitle,{children:`Are you sure you want to delete ${l} ${l>1?"images":"image"}?`})}),(0,a.jsx)(b.Z.Body,{children:"Deleting images will permanently remove them and you will not be able to recover them later."}),(0,a.jsxs)(b.Z.Footer,{children:[(0,a.jsx)(b.Z.Cancel,{onClick:i,disabled:s}),(0,a.jsx)(b.Z.Submit,{className:C().DeleteButton,disabled:s,children:s?(0,a.jsx)(y.ZP,{smallest:!0,flex:!0}):"Delete"})]})]})}function S(e){let{error:t}=e,{closeModal:l}=(0,w.d)();return(0,a.jsxs)(b.Z,{onSubmit:e=>{e.preventDefault(),l()},children:[(0,a.jsx)("div",{className:"flex px-8"}),(0,a.jsx)(b.Z.Header,{children:(0,a.jsx)(b.Z.HeaderTitle,{children:"Cannot complete download"})}),(0,a.jsx)(b.Z.Body,{children:t}),(0,a.jsx)(b.Z.Footer,{children:(0,a.jsx)(b.Z.Submit,{children:"Okay"})})]})}var Z=l(86010),E=l(60422),L=l(13346),P=l(19311),T=l(35893),F=l(62469),_=l(42796);function M(e){let{selectAll:t,allAreSelected:l,allowEdits:i=!0,deletedCallback:s}=e,r=(0,v.dW)(e=>e.active),d=(0,v.Le)(),n=(0,v.uh)(),{setModalContent:o,closeModal:c,isModalOpen:u}=(0,w.d)(),m=e=>{o((0,a.jsx)(S,{error:e}))};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:(0,Z.Z)(`flex fixed min-w-[600px] left-[50%] -translate-x-[50%] bg-pg-900 p-3 text-sm font-medium rounded-pg-md items-center z-[${j.KN.SELECT_POPOVER}]`,"border-[1px] border-pg-700","transition-all translate-y-full ease-in-out","shadow-2xl",r?"bottom-20":"-bottom-20"),children:[(0,a.jsxs)("div",{className:"flex items-center ml-1 gap-4 font-semibold text-gray-10",children:[(0,a.jsx)(L.z,{size:"icon",onClick:v.dW.getState().reset,disabled:n||u,children:(0,a.jsx)(E.Z,{})}),`${d} selected`]}),(0,a.jsx)("div",{className:"flex-grow"}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[i&&(0,a.jsx)(L.z,{size:"lg",onClick:()=>{o((0,a.jsx)(N,{deleteImages:()=>{let e=v.dW.getState(),t=e.images.map(e=>e.id);setTimeout(()=>{s(t),c()},300),e.delete()},numSelected:d}))},disabled:0===d||n||u,children:"Delete"}),(0,a.jsx)(L.z,{size:"lg",className:"min-w-[120px]",onClick:()=>{v.dW.getState().download(m)},disabled:0===d||n||u,variant:"create",children:n?(0,a.jsx)(y.ZP,{smallest:!0,flex:!0}):"Download"}),i&&(0,a.jsx)(W,{disabled:0===d||n||u})]})]})})}function W(e){let{disabled:t}=e,l=(0,v.a5)(),[i,r]=(0,s.useState)(null),d=(0,v.dW)(e=>e.images.every(e=>!e.private)),n=(0,v.dW)(e=>e.images.every(e=>e.private)),o=!(0,P.Z)();return(0,a.jsxs)(T.h_,{children:[(0,a.jsx)(T.$F,{disabled:t,asChild:!0,children:(0,a.jsx)(L.z,{size:"icon",children:(0,a.jsx)(F.AjK,{className:"w-4 h-4 "})})}),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(T.AW,{align:"end",side:window.innerWidth>1100?"right":"top",sideOffset:15,alignOffset:window.innerWidth>1100?-27:-10,children:[(0,a.jsxs)(T.Xi,{disabled:l||d,className:"flex items-center disabled:text-gray-50",onClick:()=>{r("public"),v.dW.getState().setPrivacy(!1)},children:["Make public"," ",l&&"public"===i&&(0,a.jsx)(y.ZP,{smallest:!0,flex:!0,className:"ml-2"})]}),(0,a.jsx)(_._,{open:!!o&&!l&&!n&&void 0,label:"This feature is only available to Pro users",mixpanelKey:"Change Privacy (Profile bulk action)",alignOffset:-25,sideOffset:10,children:(0,a.jsxs)(T.Xi,{disabled:l||n,className:"flex items-center disabled:text-gray-50",onClick:()=>{o||(r("private"),v.dW.getState().setPrivacy(!0))},children:["Make private"," ",l&&"private"===i&&(0,a.jsx)(y.ZP,{smallest:!0,flex:!0,className:"ml-2"})]})})]})})]})}var D=l(81810),I=l(56873),A=l(14490),z=l(41664),$=l.n(z),B=l(8891),H=l.n(B),O=l(25675),R=l.n(O),q=l(1233);function K(e){let{data:t}=e,l=(0,f.y)("new-daily-theme-grid-card"),i=(0,A.L)({fallbackData:t});return(0,a.jsx)($(),{href:"/create",onClick:()=>{H().track("Daily Theme Card Clicked",{dailyThemeId:i?.data?.id,dailyThemeTitle:i?.data?.title})},children:(0,a.jsxs)("div",{className:(0,q.cn)("overflow-hidden p-1 rounded-lg relative",l?"bg-pg-600":"bg-gray-75"),children:[(0,a.jsx)("div",{className:(0,q.cn)("absolute top-0 left-0 z-10 p-2 rounded-br-[7px] text-xs font-pg-semibold",l?"bg-pg-600 text-pg-100":"bg-gray-75 text-gray-5"),children:"DAILY THEME"}),(0,a.jsx)("div",{className:"relative",children:i?.data?.imageUrl?(0,a.jsx)(R(),{height:400,width:400,src:i?.data?.imageUrl,className:"aspect-square h-full w-full relative rounded-[4px]",alt:i?.data?.title}):null}),(0,a.jsxs)("div",{className:"z-10 relative p-3",children:[(0,a.jsx)("h2",{className:"text-gray-5 font-bold text-sm",children:i?.data?.title}),(0,a.jsx)("p",{className:"text-gray-25 text-sm",children:i?.data?.body})]})]})})}let U={300:2,440:2,800:3,1200:4,1600:5,3e3:7,3400:8,4e3:9};function V(e){let{className:t,initialImages:l,initialCursor:m,options:h,sortBy:g,filter:p,dateFilter:j,emptyState:y,onScroll:b,groupBatchedImages:k=!1,hideProfileImages:C=!1,scrollThreshold:N=.8,showDailyThemeCard:S,dailyTheme:Z}=e,[E,L]=(0,s.useState)(null),[P,T]=(0,s.useState)(!1),[F,_]=(0,s.useState)(null),W=(0,o.useRouter)(),A="/profile/likes/[id]"===W.pathname,{isLoadingMore:z,haveMoreImages:$,getMoreImages:B,setImages:H,images:O,showEmptyImages:R}=x({initialImages:l,initialCursor:m,options:h,sortBy:g,filter:p,dateFilter:j}),{setImageData:q}=(0,u.g)(),{isModalOpen:V,closeModal:X}=(0,w.d)(),J=I.t5.useUserHasPermission("moderation:images:private"),Q=(0,f.y)("show-grid-loading"),Y=(0,s.useCallback)(async function(e,t){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];L(t),q(e);let{id:i}=e;W.query.postId=i,a&&W.push(W,`/post/${(0,D.Td)(e)}`,{shallow:!0}),l&&localStorage.setItem("modal-return-to",W.asPath)},[W,q]),G=(0,c.Z)(),ee=(0,s.useMemo)(()=>{let e=[];return O?.forEach(t=>{if(t.hide)return;let l=e.find(e=>e.id===t.batchId);l?l.images.length<4&&l.images.push(t):e.push({id:k&&t.batchId?t.batchId:t.id,images:[t]})}),S?[{id:"daily-theme-batch",images:[{id:"daily-theme",isDailyTheme:!0}]},...e]:e},[O,k,S]),et=(0,s.useCallback)(async e=>{if(null!==E){let t=E+e;if(S&&0===t)return;let l=S?O.length+1:O.length;if(t>=0&&t<l){let e=ee[t].images?.[0];if(ee[t].images?.[0]?.id)return Y(e,t,!1,!0)}t>=O.length-2&&await B()}},[ee,B,O.length,Y,E,S]);(0,s.useEffect)(()=>v.dW.getState().reset,[]),(0,s.useEffect)(()=>{let e=async e=>{switch(e.key?.toLowerCase()){case"arrowleft":case"arrowright":if(!W?.query.postId)return;et("ArrowRight"===e.key?1:-1);break;case"shift":console.log("Multi-select: on"),T(!0);break;case"escape":V?X():v.dW.getState().reset()}};document.addEventListener("keydown",e);let t=async e=>{e.key?.toLowerCase()==="shift"&&(console.log("Multi-select: off"),T(!1))};return document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[O,et,W?.query.postId,E,V,X]),(0,s.useEffect)(()=>{let e=()=>et(1),t=()=>et(-1);return document.addEventListener("pai:modal:next",e),document.addEventListener("pai:modal:prev",t),()=>{document.removeEventListener("pai:modal:next",e),document.removeEventListener("pai:modal:prev",t)}},[et]);let el=(0,s.useMemo)(()=>O.some(e=>e.hide),[O]),ea=(e,t)=>{H(l=>l.map(l=>t.includes(l.id)?{...l,hide:e}:l))},{width:ei}=(0,n.iP)(),es=(0,s.useMemo)(()=>(0,n.QN)(ei,U),[ei]),er=(0,v.dW)(e=>e.active),ed=(0,v.Le)()===O.length,en=e=>{let{col:t,row:l}=e;return l*es+t},eo=(0,s.useMemo)(()=>{let e=-1,t={0:0,1:0,2:0,3:0,4:0};O.length;let l={};return ee.forEach(a=>{let i=(e+=1)%es,s=t[i];t[i]+=2===a.images.length?1:2,a.images.forEach((e,t)=>{l[e.id]={col:i+([1,3].includes(t)?.5:0),row:s+([0,1].includes(t)?0:1)}})}),l},[ee,O.length,es,$]),ec=e=>{let t=v.dW.getState();if(!t.downloadLoading&&!t.deleteLoading){if(t.isSelected(e.id))t.deselect(e.id);else{_(e.id);let l={id:e.id,url:e.url,prompt:e.prompt,private:e.private,publishedFromCanvas:e.fromCanvas};if(P&&t.images.length&&F){if(P){let l=eo[F],a=eo[e.id],i=en(l),s=en(a);if(s>i){let l=O.filter(e=>!e.hide).filter(e=>en(eo[e.id])>=i&&en(eo[e.id])<=s).map(t=>({id:t.id,url:t.url,prompt:t.prompt,private:t.private,publishedFromCanvas:e.fromCanvas}));t.selectAll([...t.images,...l.filter(e=>!t.images.some(t=>t.id===e.id))])}else if(s<i){let l=O.filter(e=>!e.hide).filter(e=>en(eo[e.id])>=s&&en(eo[e.id])<=i).map(t=>({id:t.id,url:t.url,prompt:t.prompt,private:t.private,publishedFromCanvas:e.fromCanvas}));t.selectAll([...t.images,...l.filter(e=>!t.images.some(t=>t.id===e.id))])}}}else t.select(l)}}},eu=(0,s.useRef)(null);return G?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{ref:eu,className:t,dataLength:O.length,next:B,hasMore:$,loader:(0,a.jsx)(a.Fragment,{}),style:{overflow:"visible"},scrollThreshold:N,onScroll:()=>b?.(eu.current?.lastScrollTop),children:(0,a.jsx)(n.ZP,{columnsCountBreakPoints:U,children:ee.length&&!R?(0,a.jsx)(i.Z,{gutter:"4px",children:ee.map((e,t)=>{let l=Math.min(e.images.length,2);return(0,a.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:`repeat(${l}, minmax(0, 1fr))`},children:e.images.map((e,i)=>{if(e.isDailyTheme)return(0,a.jsx)(K,{data:Z},"daily-theme-card");let s=0===t;return(0,a.jsx)(d.F,{highFetchPriority:s,id:e.id,width:e.width,height:e.height,aspectRatio:(e.width??1)/(e.height??1),prompt:l>1?"":e.prompt,showPrompt:!0,url:e.url,url_jpeg:e.url_jpeg,title:e.title,isPrivate:e.private,createdAt:e.createdAt,source:e.source,user:{id:e.user.id,name:e.user.displayName,avatar:e.user.image},hideImage:C,isLiked:e.userLiked??!1,numLikes:e.likeCount??0,fromCanvas:e.fromCanvas,onClick:l=>{if(er){ec(e);return}P&&(console.log("Multi-select: off [2]"),T(!1)),l.metaKey||P||Y(e,t)},setHidden:ea,forceVisible:el||s,parent_image_url:e.parent_image_url},`${e.id}-${i}`)})},e.id)})}):(0,a.jsx)("p",{className:"text-gray-400 p-10",children:y||R||"No images."})})}),Q&&$&&z&&(0,a.jsx)("div",{className:"text-center text-pg-300 p-4",children:"Loading more..."}),(0,a.jsx)(M,{selectAll:()=>{let e=O.map(e=>({id:e.id,url:e.url,prompt:e.prompt,private:e.private,publishedFromCanvas:e.fromCanvas}));v.dW.getState().selectAll(e)},allAreSelected:ed,deletedCallback:e=>ea(!0,e),allowEdits:!A||J})]}):null}},41301:function(e){e.exports={DeleteButton:"DeleteCanvas_DeleteButton__6ok_T"}}}]);